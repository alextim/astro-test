---
import i18n from '@/config/i18n';
import config from '@/config/website';
import { getLocaleFromPathname } from '@/lib/pathname-utils';
import AsidePosts from './AsidePosts.astro';

export interface Props {
  t: (string) => string;
}

const locale = Astro.request.params.locale || i18n.defaultLocale;

// TODO: sort: { fields: [featured, datePublished], order: [ASC, DESC] }
const posts = Astro.fetchContent('../../../../../content/blog/posts/*/*.??.md')
  ?.filter((p) => getLocaleFromPathname(p.file.pathname) === locale)
  .sort((a, b) => new Date(b.datePublished).valueOf() - new Date(a.datePublished).valueOf())
  .slice(0, config.recentPostsLimit);
const { t } = Astro.props;
---

<AsidePosts title={t('post.widget.recent')} items={posts} />
