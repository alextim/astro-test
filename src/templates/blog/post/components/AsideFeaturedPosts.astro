---
import AsidePosts from './AsidePosts.astro';
import i18n from '@/config/i18n';
import { getLocaleFromPathname } from '@/lib/pathname-utils';

const locale = Astro.request.params.locale || i18n.defaultLocale;

// TODO: sort: { fields: [featured, datePublished], order: [ASC, DESC] }
const posts = Astro.fetchContent('../../../../../content/blog/posts/*/*.??.md')
  ?.filter((p) => getLocaleFromPathname(p.file.pathname) === locale && p.featured)
  .sort((a, b) => new Date(b.datePublished).valueOf() - new Date(a.datePublished).valueOf());
const { t } = Astro.props;
---

<AsidePosts title={t('post.widget.featured')} items={posts} />
