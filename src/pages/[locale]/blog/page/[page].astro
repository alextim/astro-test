---
import config from '@/config/website';
import i18n from '@/config/i18n';
import { getLocaleFromPathname } from '@/lib/pathname-utils';
import { getPost, defaultSort } from '@/lib/cms';
// import getPaths from '../../../lib/getPaths';
import BlogIndex from '@/templates/blog/blog/blog.astro';

export async function getStaticPaths({ paginate }) {
  const r = Object.keys(i18n.locales)
    .filter((locale) => locale !== i18n.defaultLocale)
    .map((locale) => {
      const posts = Astro.fetchContent('../../../../../content/blog/posts/*/*.??.md')
        .filter((p) => getLocaleFromPathname(p.file.pathname) === locale)
        .sort(defaultSort)
        .map(getPost);
      return paginate(posts, {
        params: { locale },
        pageSize: config.pageSize,
      });
    });
  return r;
}

const { page } = Astro.props;
---

<BlogIndex {page} />
