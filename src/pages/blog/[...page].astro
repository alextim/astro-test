---
import config from '../../config/website';
import i18n from '../../config/i18n';
import { getLocaleFromPathname } from '../../lib/getPostInfo';
import BlogIndex from '../../templates/blog/blog/blog.astro';

export async function getStaticPaths({ paginate }) {
  const locale = i18n.defaultLocale;
  // TODO: sort: { fields: [featured, datePublished], order: [ASC, DESC] }

  const posts = Astro.fetchContent('../../../content/blog/posts/*/*.??.md')
    .filter((p) => getLocaleFromPathname(p.file.pathname, true) === locale)
    .sort((a, b) => new Date(b.datePublished).valueOf() - new Date(a.datePublished).valueOf());
  console.log(posts.length);

  return paginate(posts, {pageSize: config.pageSize});
}

const { page } = Astro.props;
---
<BlogIndex page={page} />
